<?php
/*  
Template Name: Custom Homepage  
*/
get_header();
?>

<div>

    <div class="section-hero-container">
        <section class="section-hero">
            <div class="section-top container mb-5">
                <h1>ALOHA<span>SUSHI</span></h1>
                <div class="section-top-content">
                    <div class="section-top-text">
                        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Magni dicta ut explicabo vel quisquam molestias libero ipsa? Illum necessitatibus cumque, animi, rerum similique deleniti deserunt itaque vero dicta, voluptate pariatur.</p>
                    </div>
                    <div class="section-top-img">
                        <img class="" src="<?php echo get_template_directory_uri(); ?>/imgs/plate-4.png" alt="Sushi Image">
                    </div>
                    <div class="section-top-imgs">
                        <img class="" src="<?php echo get_template_directory_uri(); ?>/imgs/plate-1.jpg" alt="Sushi Image">
                        <img class="" src="<?php echo get_template_directory_uri(); ?>/imgs/plate-2.jpg" alt="Sushi Image">
                        <img class="" src="<?php echo get_template_directory_uri(); ?>/imgs/plate-3.png" alt="Sushi Image">
                        <img class="" src="<?php echo get_template_directory_uri(); ?>/imgs/plate-4.png" alt="Sushi Image">
                    </div>


                </div>
            </div>

            <div id="scroll-container">
                <div id="scroll-text">
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>

                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>

                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                </div>
            </div>

            <div id="scroll-container-bottom">

                <div id="scroll-text-bottom">
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>

                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>

                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- CATEGORY -->
    <section class="section-categories container">
        <div class="title-top">
            <h1>OUR BEST <span>CATEGORIES</span></h1>
            <button>SEE ALL <i class="fas fa-arrow-right"></i></button>
        </div>

        <div class="swiper-container swiper-categories">
            <div class="swiper-wrapper">
                <?php
                $args = array(
                    'taxonomy'   => 'product_cat',
                    'orderby'    => 'name',
                    'hide_empty' => true,
                );
                $categories = get_terms($args);
                $menu_url = home_url('/menu');

                if (!empty($categories)) {
                    foreach ($categories as $category) {
                        // category details
                        $thumbnail_id = get_term_meta($category->term_id, 'thumbnail_id', true);
                        $image_url = wp_get_attachment_url($thumbnail_id);
                        $product_count = isset($category->count) ? $category->count : 0;

                        // filtrer
                        $category_url = add_query_arg('category', $category->slug, $menu_url);

                        echo '<div class="swiper-slide">';
                        echo '<div class="category">';
                        if ($image_url) {
                            echo '<a href="' . esc_url($category_url) . '">';
                            echo '<img src="' . esc_url($image_url) . '" alt="' . esc_attr($category->name) . '">';
                            echo '</a>';
                        }
                        echo '<a class="category-content" href="' . esc_url($category_url) . '">';
                        echo '<h2>' . esc_html(strtoupper($category->name)) . '</h2>';
                        echo '<h4>' . esc_html($product_count) . ' products</h4>';
                        echo '</a>';
                        echo '</div>';
                        echo '</div>';
                    }
                }
                ?>
            </div>
            <div class="bottom-arc"></div>

            <!-- Add Pagination -->
            <!-- <div class="swiper-pagination"></div> -->

            <!-- Add Navigation (Optional) -->
            <!-- <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div> -->
        </div>
    </section>
    <!-- WHY -->
    <section class="section-why">
        <div class="wave-top"></div>
        <div class="container">
            <div class="image-container" data-aos="fade-up-right" data-aos-duration="1500" data-aos-easing="ease-in-out">
                <img src="<?php echo get_template_directory_uri(); ?>/imgs/img-1.png" alt="Sushi Image">
            </div>
            <div class="content" data-aos="fade-up-left" data-aos-duration="1500" data-aos-easing="ease-in-out">
                <h2 class="title">WHY CHOOSE <span>US</span></h2>
                <p>The mouth-watering aroma of sizzling burgers now fills the streets of Birmingham thanks to the passionate pursuit of three brothers</p>

                <div class="features">
                    <div class="feature">
                        <div class="feature-icon">🍣</div>
                        <h3>A NEW LOOK ON THE RIGHT DOOR!</h3>
                    </div>
                    <div class="feature">
                        <div class="feature-icon">🥗</div>
                        <h3>THE USE OF NATURAL BEST QUALITY PRODUCTS</h3>
                    </div>
                    <div class="feature">
                        <div class="feature-icon">🚚</div>
                        <h3>FASTEST ON YOUR DOOR STEP</h3>
                    </div>
                </div>

                <button class="order-btn">ORDER NOW →</button>
            </div>
        </div>
        <div class="wave-bottom"></div>
    </section>
    <!-- PRODUCTS -->
    <section class="section-products container">
        <div class="title-top">
            <h1>OUR BEST <span> DISHES</span></h1>
            <button>SEE ALL <i class="fas fa-arrow-right"></i></button>
        </div>

        <div class="swiper-container swiper-products">
            <div class="swiper-wrapper">
                <?php
                $args = array(
                    'post_type' => 'product',
                    'posts_per_page' => 5,
                );
                $loop = new WP_Query($args);

                if ($loop->have_posts()) {
                    while ($loop->have_posts()) : $loop->the_post();
                ?>

                        <div class="swiper-slide">
                            <div class="product">
                                <a class="a" onclick="showProductDetails('<?php echo esc_attr($product->get_id()); ?>')">
                                    <div class="product-top">
                                        <?php if (has_post_thumbnail()) {
                                            the_post_thumbnail('medium', ['class' => 'img']);
                                        } ?>
                                        <div class="product-recepies">
                                            <p>Lorem.</p>
                                            <p>Lorem.</p>
                                            <p>Lorem.</p>
                                        </div>
                                    </div>
                                </a>
                                <div class="product-content">
                                    <h4><?php the_title(); ?></h4>
                                    <p>Lorem ipsum | dolor | sit amet | consectetur.</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h3><?php echo get_post_meta(get_the_ID(), '_price', true); ?>€</h3>

                                        <i onclick="addToCartProduct(<?php echo esc_attr($product->get_id()); ?>, event)" class="fa-solid fa-cart-shopping"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                <?php
                    endwhile;
                } else {
                    echo 'No products found.';
                }
                wp_reset_postdata();
                ?>
            </div>

            <!-- Add Pagination -->
            <!-- <div class="swiper-pagination"></div> -->

            <!-- Add Navigation (Optional) -->
            <!-- <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div> -->
        </div>





    </section>
    <!-- PROMO -->
    <div class="promo">

        <div class="wave-top"></div>
        <div class="promo-section">
            <div class="container">
                <p data-aos="fade-up-right" data-aos-duration="1500" data-aos-easing="ease-in-out">40% OFF ALL PREMIUM PIZZAS</p>
                <h1 data-aos="fade-up-left" data-aos-duration="1500" data-aos-easing="ease-in-out">HAPPY SUNDAY</h1>
                <a href="#" class="order-btn">ORDER NOW</a>
                <div class="promo-img-1">
                    <img src="<?php echo get_template_directory_uri(); ?>/imgs/img-5.png" alt="Sushi Image">
                </div>
                <div class="promo-img-2">
                    <img src="<?php echo get_template_directory_uri(); ?>/imgs/img-1.png" alt="Sushi Image">
                </div>
            </div>
        </div>
        <div class="wave-bottom"></div>
    </div>
    <!-- ORDER -->
    <section class="section-order" data-aos="fade-up" data-aos-duration="1500" data-aos-easing="ease-in-out">
        <a href="">
            <div class="order-img container">
                <img src="<?php echo get_template_directory_uri(); ?>/imgs/promo-bg-3.png" alt="Sushi Image">
            </div>
        </a>
    </section>
    <!-- DISHES -->
    <section class="section-products-dishes">

        <div class="wave-top"></div>
        <div class="title-top container">
            <h1>OUR BEST <span>DISHES</span></h1>
            <button>SEE ALL <i class="fas fa-arrow-right"></i></button>
        </div>


        <div class="swiper-container container swiper-products">
            <div class="swiper-wrapper">
                <?php
                $args = array(
                    'post_type' => 'product',
                    'posts_per_page' => 12,
                );
                $loop = new WP_Query($args);

                if ($loop->have_posts()) {
                    while ($loop->have_posts()) : $loop->the_post();
                ?>

                        <div class="swiper-slide">
                            <div class="product">
                                <a class="a" onclick="showProductDetails('<?php echo esc_attr($product->get_id()); ?>')">
                                    <div class="product-top">
                                        <?php if (has_post_thumbnail()) {
                                            the_post_thumbnail('medium', ['class' => 'img']);
                                        } ?>
                                        <div class="product-recepies">
                                            <p>Lorem.</p>
                                            <p>Lorem.</p>
                                            <p>Lorem.</p>
                                        </div>
                                    </div>
                                </a>
                                <div class="product-content">
                                    <h4><?php the_title(); ?></h4>
                                    <p>Lorem ipsum | dolor | sit amet | consectetur.</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h3><?php echo get_post_meta(get_the_ID(), '_price', true); ?>€</h3>
                                        <i onclick="addToCartProduct('<?php echo esc_attr($product->get_id()); ?>', event)" class="fa-solid fa-cart-shopping"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                <?php
                    endwhile;
                } else {
                    echo 'No products found.';
                }
                wp_reset_postdata();
                ?>
            </div>

            <!-- Add Pagination -->
            <!-- <div class="swiper-pagination"></div> -->

            <!-- Add Navigation (Optional) -->
            <!-- <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div> -->
        </div>

        <div class="wave-bottom"></div>
    </section>
    <!-- PROMOTION -->
    <section class="section-promo-container">
        <div class="section-promo container">
            <div class="promo-img" data-aos="fade-right" data-aos-duration="1500" data-aos-easing="ease-in-out">
                <img src="<?php echo get_template_directory_uri(); ?>/imgs/promo-1.jpg" alt="Sushi Image">
            </div>
            <div class="promo-content">
                <div class="promo-content-img" data-aos="flip-down" data-aos-duration="1500" data-aos-easing="ease-in-out">
                    <img src="<?php echo get_template_directory_uri(); ?>/imgs/promo-bg-1.jpg" alt="Sushi Image">
                </div>
                <div class="promo-content-img" data-aos="flip-down" data-aos-duration="1500" data-aos-easing="ease-in-out">
                    <img src="<?php echo get_template_directory_uri(); ?>/imgs/promo-bg-3.png" alt="Sushi Image">
                </div>
            </div>
        </div>
    </section>
    <!-- NEWSLETTER -->
    <section class="section-newsletter-container">
        <div class="section-newsletter container">
            <div class="d-flex flex-column justify-content-center align-items-center">
                <h1 data-aos="fade-up-left" data-aos-duration="1500" data-aos-easing="ease-in-out">JOIN FOR HOT OFFERS!</h1>
                <p data-aos="fade-up-right" data-aos-duration="1500" data-aos-easing="ease-in-out">Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptatem eveniet nesciunt fugiat itaque unde non debitis sit porro, obcaecati ex. Eius voluptate perspiciatis facilis, inventore cupiditate suscipit eum voluptates voluptas!
                </p>
            </div>
            <div>
                <form id="newsletter-form">
                    <input type="email" name="email" id="email" placeholder="Enter your adress email" required data-aos="fade-up-left" data-aos-duration="1500" data-aos-easing="ease-in-out">
                    <button data-aos="fade-up-right" data-aos-duration="1500" data-aos-easing="ease-in-out"><i class="fa-solid fa-paper-plane me-1"></i> Subscribe</button>
                </form>
            </div>
            <img class="newsletter-img-left" src="<?php echo get_template_directory_uri(); ?>/imgs/img-2.png" alt="Sushi Image">
            <img class="newsletter-img-right" src="<?php echo get_template_directory_uri(); ?>/imgs/img-1.png" alt="Sushi Image">

        </div>
    </section>







    <!-- PANIER -->
    <section class="cart-btn-container">
        <div class="cart-btn">
            <span value="0">0</span>
            <h4><i class="fa-solid fa-cart-shopping"></i></h4>
        </div>
    </section>

    <!-- SHOPING CART -->
    <div class="cart-popup" id="cartPopup">
        <div class="cart-popup-content">
            <div class="cart-header">
                <h3>Shopping Cart</h3>
                <span class="close-cart">&times;</span>
            </div>
            <div class="cart-items">
                <div class="cart-empty-message">
                    <div id="empty-cart-message" style="display: none;">
                        <h1 style="font-size: 3rem;"><i class="fa-regular fa-calendar-xmark"></i></h1>
                        <p>YOUR CART IS EMPTY ORDER NOW!!</p>
                    </div>
                </div>
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    <span>Total:</span>
                    <span id="cartTotal">0.00€</span>
                </div>
                <button class="checkout-btn">Checkout</button>
            </div>
        </div>
    </div>






















    <!-- Product-details -->
    <div id="productDetailsPopup" class="product-details-popup" style="display: none;">
        <div class="product-details-content">
            <button class="close-popup" onclick="closeProductDetails()">&times;</button>
            <div id="productDetailsContent">
            </div>
        </div>
    </div>

    <script>
        <?php
        $rest_url = esc_url_raw(rest_url('/wc/v3/products/'));
        $consumer_key = 'ck_293896f56cc0ecddc28b4c79984c73c52a6a43e2';
        $consumer_secret = 'cs_349bd60084e10ae4acd409f011055f68bf073fec';
        ?>



        let cart = [];
        let cartCount = 0;

        function showProductDetails(productId) {
            const popup = document.getElementById('productDetailsPopup');
            const content = document.getElementById('productDetailsContent');

            content.innerHTML = '<div class="product-details-loading"><p class="loader"></p></div>';
            popup.style.display = 'flex';

            const formData = new FormData();
            formData.append('action', 'get_product_details');
            formData.append('nonce', productAjax.nonce);
            formData.append('product_id', productId);

            fetch(productAjax.ajaxurl, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(response => {
                    if (!response.success) {
                        throw new Error(response.data);
                    }

                    const product = response.data;

                    content.innerHTML = `  
                        <div class="product-popup-content">  
                            <div class="product-image-section">  
                                <img src="${product.image}" alt="${product.name}" class="main-product-image">
                            </div>  
                            
                            <div class="p-details-content mt-3">
                                <div class="product-details-content-top">
                                    <h2 class="mb-3">${product.name}</h2>
                                    <div class="quantity-controls">  
                                        <button onclick="changeProductQuantity(${product.id}, -1)" class="quantity-btn">-</button>  
                                        <input type="text" id="productQuantity" class="product-quantity" value="1" min="1">  
                                        <button onclick="changeProductQuantity(${product.id}, 1)" class="quantity-btn">+</button>  
                                    </div>  
                                </div>
                                <div class="accordion" id="productAccordion">  
                                    <div class="accordion-item">  
                                        <h3 class="accordion-header">  
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse"   
                                                    data-bs-target="#descriptionCollapse" aria-expanded="true">  
                                                Description  
                                            </button>  
                                        </h3>  
                                        <div id="descriptionCollapse" class="accordion-collapse collapse show"   
                                            data-bs-parent="#productAccordion">  
                                            <div class="accordion-body">  
                                                ${product.description || product.short_description}  
                                            </div>  
                                        </div>  
                                    </div>  
            
                                    <div class="accordion-item">  
                                        <h3 class="accordion-header">  
                                            <button class="accordion-button collapsed" type="button"   
                                                    data-bs-toggle="collapse" data-bs-target="#allergenCollapse">  
                                                Allergens  
                                            </button>  
                                        </h3>  
                                        <div id="allergenCollapse" class="accordion-collapse collapse"   
                                            data-bs-parent="#productAccordion">  
                                            <div class="accordion-body">  
                                                <!-- Add allergen information here -->  
                                                <p>Allergen information will be displayed here.</p>  
                                            </div>  
                                        </div>  
                                    </div>  
                                </div>  
            
                                <div id="productAddonsContainer" class="product-addons-container my-3 py-3" style="border-top: .1rem solid white;border-bottom: .1rem solid white;">
                                </div>  
            
                                <div class="product-details-buy">  
                                    <div class="product-price">  
                                        ${product.sale_price}€  
                                    </div> 
                                        <i class="fa-solid fa-cart-shopping" onclick="addToCart(${product.id})"></i>  
                                </div>  
                            </div>  
                        </div>
                    `;

                    fetchProductAddons(productId);
                })
                .catch(error => {
                    content.innerHTML = `  
                        <div class="error-message">  
                            <p>Error loading product details. Please try again.</p>  
                            <button onclick="closeProductDetails()" class="close-error-btn">Close</button>  
                        </div>  
                    `;
                    console.error('Error:', error);
                });
        }



        // function fetchProductAddons(productId) {
        //     const addonsContainer = document.getElementById('productAddonsContainer');

        //     fetch(`/aloha_sushi/wp-json/custom/v1/product-addons/${productId}`)
        //         .then(response => {
        //             if (!response.ok) throw new Error('Failed to fetch addons');
        //             return response.json();
        //         })
        //         .then(addons => {
        //             if (addons.length === 0) {
        //                 addonsContainer.innerHTML = '<p>No addons available for this product.</p>';
        //                 return;
        //             }

        //             addonsContainer.innerHTML = addons.map(addon => `
        //         <div class="addon-group">
        //             <h4>${addon.group_title}</h4>
        //             ${addon.fields.map(field => `
        //                 <div class="addon-field"> 
        //                     <div class="addon-content">
        //                         ${field.type === 'radio' ? `
        //                             ${field.options.map(option => `
        //                                 <div class="addon-option">
        //                                     <label>
        //                                         ${option.image ? `<img src="${option.image}" alt="${option.label}" class="addon-image">` : ''}
        //                                         ${option.label} (+${option.price}€)
        //                                     </label>
        //                                     <input type="radio" name="addon_${field.id}" value="${option.id}">
        //                                 </div>
        //                             `).join('')}
        //                         ` : ''}
        //                         ${field.type === 'checkbox' ? `
        //                             ${field.options.map(option => `
        //                                 <div class="addon-option">
        //                                     <label class="checkbox-label">
        //                                         ${option.image ? `<img src="${option.image}" alt="${option.label}" class="addon-image">` : ''}

        //                                         ${option.label} / +${option.price}€
        //                                     </label>
        //                                     <input type="checkbox" class="custom-checkbox" name="addon_${field.id}[]" value="${option.id}">
        //                                 </div>
        //                             `).join('')}
        //                         ` : ''}
        //                         ${field.type === 'select' ? `
        //                             <select name="addon_${field.id}">
        //                                 ${field.options.map(option => `
        //                                     <option value="${option.id}">
        //                                         ${option.label} (+${option.price}€)
        //                                     </option>
        //                                 `).join('')}
        //                             </select>
        //                         ` : ''}
        //                     </div>
        //                 </div>
        //             `).join('')}
        //         </div>
        //     `).join('');
        //         })
        //         .catch(error => {
        //             addonsContainer.innerHTML = '<p>Error loading addons. Please try again.</p>';
        //             console.error('Error:', error);
        //         });
        // }

        // function fetchProductAddons(productId) {
        //     const addonsContainer = document.getElementById('productAddonsContainer');

        //     fetch(`/aloha_sushi/wp-json/custom/v1/product-addons/${productId}`)
        //         .then(response => {
        //             if (!response.ok) throw new Error('Failed to fetch addons');
        //             return response.json();
        //         })
        //         .then(addons => {
        //             if (addons.length === 0) {
        //                 addonsContainer.innerHTML = '<p>No addons available for this product.</p>';
        //                 return;
        //             }

        //             addonsContainer.innerHTML = addons.map(addon => `
        //                     <div class="addon-group">
        //                         <h4>${addon.group_title}</h4>
        //                         ${addon.fields.map(field => `
        //                             <div class="addon-field" onclick="toggleAddonField(this)">
        //                                 <div class="addon-content">
        //                                     ${field.type === 'radio' ? `
        //                                         ${field.options.map(option => `
        //                                             <div class="addon-option">
        //                                                 <label>
        //                                                     ${option.image ? `<img src="${option.image}" alt="${option.label}" class="addon-image">` : ''}
        //                                                     ${option.label} (+${option.price}€)
        //                                                 </label>
        //                                                 <input type="radio" name="addon_${field.id}" value="${option.id}" style="display: none;">
        //                                                 <i class="fa-solid fa-check addon-check-icon" style="display: none;"></i>
        //                                             </div>
        //                                         `).join('')}
        //                                     ` : ''}
        //                                     ${field.type === 'checkbox' ? `
        //                                         ${field.options.map(option => `
        //                                             <div class="addon-option">
        //                                                 <label>
        //                                                     ${option.image ? `<img src="${option.image}" alt="${option.label}" class="addon-image">` : ''}
        //                                                     ${option.label} (+${option.price}€)
        //                                                 </label>
        //                                                 <input type="checkbox" name="addon_${field.id}[]" value="${option.id}" style="display: none;">
        //                                                 <i class="fa fa-check addon-check-icon" style="display: block;"></i>
        //                                             </div>
        //                                         `).join('')}
        //                                     ` : ''}
        //                                     ${field.type === 'select' ? `
        //                                         <select name="addon_${field.id}">
        //                                             ${field.options.map(option => `
        //                                                 <option value="${option.id}">
        //                                                     ${option.label} (+${option.price}€)
        //                                                     <i class="fa fa-check addon-check-icon" style="display: block;"></i>
        //                                                 </option>
        //                                             `).join('')}
        //                                         </select>
        //                                     ` : ''}
        //                                 </div>
        //                             </div>
        //                         `).join('')}
        //                     </div>
        //                 `).join('');
        //             })
        //         .catch(error => {
        //             addonsContainer.innerHTML = '<p>Error loading addons. Please try again.</p>';
        //             console.error('Error:', error);
        //         });
        // }

        function fetchProductAddons(productId) {
            const addonsContainer = document.getElementById('productAddonsContainer');

            fetch(`/aloha_sushi/wp-json/custom/v1/product-addons/${productId}`)
                .then(response => {
                    if (!response.ok) throw new Error('Failed to fetch addons');
                    return response.json();
                })
                .then(addons => {
                    if (addons.length === 0) {
                        addonsContainer.innerHTML = '<p>No addons available for this product.</p>';
                        return;
                    }

                    addonsContainer.innerHTML = addons.map(addon => `
                <div class="addon-group">
                    <h4>${addon.group_title}</h4>
                    ${addon.fields.map(field => `
                        <div class="addon-field" onclick="toggleAddonField(this)">
                            <div class="addon-content">
                                ${field.type === 'radio' ? `
                                    ${field.options.map(option => `
                                        <div class="addon-option">
                                            <label>
                                                ${option.image ? `<img src="${option.image}" alt="${option.label}" class="addon-image">` : ''}
                                                ${option.label} (+${option.price}€)
                                            </label>
                                            <input type="radio" name="addon_${field.id}" value="${option.id}" style="display: none;">
                                            <i class="fa-solid fa-check addon-check-icon"></i>
                                        </div>
                                    `).join('')}
                                ` : ''}
                                ${field.type === 'checkbox' ? `
                                    ${field.options.map(option => `
                                        <div class="addon-option">
                                            <label>
                                                ${option.image ? `<img src="${option.image}" alt="${option.label}" class="addon-image">` : ''}
                                                ${option.label} (+${option.price}€)
                                            </label>
                                            <input type="checkbox" name="addon_${field.id}[]" value="${option.id}" style="display: none;">
                                            <i class="fa-solid fa-check addon-check-icon"></i>
                                        </div>
                                    `).join('')}
                                ` : ''}
                                ${field.type === 'select' ? `
                                    <select name="addon_${field.id}">
                                        ${field.options.map(option => `
                                            <option value="${option.id}">
                                                ${option.label} (+${option.price}€)
                                            </option>
                                        `).join('')}
                                    </select>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
                })
                .catch(error => {
                    addonsContainer.innerHTML = '<p>Error loading addons. Please try again.</p>';
                    console.error('Error:', error);
                });
        }


        function toggleAddonField(addonField) {
            const input = addonField.querySelector('input');
            const checkIcon = addonField.querySelector('.addon-check-icon');

            if (input.type === 'radio') {
                const groupName = input.name;
                const allOptions = document.querySelectorAll(`input[name="${groupName}"]`);
                allOptions.forEach(option => {
                    const parentField = option.closest('.addon-field');
                    const icon = parentField.querySelector('.addon-check-icon');
                    option.checked = false;
                    if (icon) icon.classList.remove('active');
                });

                input.checked = true;
                checkIcon.classList.add('active');
            } else if (input.type === 'checkbox') {
                input.checked = !input.checked;
                if (input.checked) {
                    checkIcon.classList.add('active');
                } else {
                    checkIcon.classList.remove('active');
                }
            }
        }


        function closeProductDetails() {
            document.getElementById('productDetailsPopup').style.display = 'none';
        }

        function changeProductQuantity(productId, delta) {
            const quantityInput = document.getElementById('productQuantity');
            let newQuantity = parseInt(quantityInput.value) + delta;
            if (newQuantity < 1) newQuantity = 1; // la valeur est positive
            quantityInput.value = newQuantity;
        }

        function addToCart(productId) {
            const quantityInput = document.getElementById('productQuantity');
            const quantity = parseInt(quantityInput.value) || 1;

            const selectedAddons = [];
            const addonContainer = document.getElementById('productAddonsContainer');

            addonContainer.querySelectorAll('input[type="radio"]:checked').forEach(radio => {
                const label = radio.closest('.addon-option').querySelector('label').textContent.trim();
                const priceMatch = label.match(/\+(\d+\.?\d*)€/);
                const price = priceMatch ? parseFloat(priceMatch[1]) : 0;
                selectedAddons.push({
                    type: 'radio',
                    label: label.replace(/\+\d+\.?\d*€/, '').trim(),
                    price: price
                });
            });

            addonContainer.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                const label = checkbox.closest('.addon-option').querySelector('label').textContent.trim();
                const priceMatch = label.match(/\+(\d+\.?\d*)€/);
                const price = priceMatch ? parseFloat(priceMatch[1]) : 0;
                selectedAddons.push({
                    type: 'checkbox',
                    label: label.replace(/\+\d+\.?\d*€/, '').trim(),
                    price: price
                });
            });

            addonContainer.querySelectorAll('select').forEach(select => {
                if (select.value) {
                    const selectedOption = select.options[select.selectedIndex];
                    const label = selectedOption.textContent.trim();
                    const priceMatch = label.match(/\+(\d+\.?\d*)€/);
                    const price = priceMatch ? parseFloat(priceMatch[1]) : 0;
                    selectedAddons.push({
                        type: 'select',
                        label: label.replace(/\+\d+\.?\d*€/, '').trim(),
                        price: price
                    });
                }
            });

            const productName = document.querySelector('.product-popup-content h2').textContent;
            const productPriceText = document.querySelector('.product-price').textContent.trim();
            const productPrice = parseFloat(productPriceText.replace(/[^0-9.]/g, '').replace(',', '.'));
            if (isNaN(productPrice)) {
                console.error('Invalid product price:', productPriceText);
                return;
            }

            const productImage = document.querySelector('.main-product-image').src;

            const addonsTotalPrice = selectedAddons.reduce((total, addon) => total + addon.price, 0);
            console.log('Selected addons:', selectedAddons);
            console.log('Addons total price:', addonsTotalPrice);

            const totalPrice = productPrice + addonsTotalPrice;

            const existingProductIndex = cart.findIndex(item =>
                item.id === productId &&
                JSON.stringify(item.addons) === JSON.stringify(selectedAddons)
            );

            if (existingProductIndex !== -1) {
                cart[existingProductIndex].quantity += quantity;
            } else {
                cart.push({
                    id: productId,
                    name: productName,
                    basePrice: productPrice,
                    totalPrice: totalPrice,
                    image: productImage,
                    quantity: quantity,
                    addons: selectedAddons
                });
            }

            updateCartCount();
            updateCartDisplay();
            showCartPopup();
            closeProductDetails();
        }

        // SHOPPING CART
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const cartItems = document.getElementById('cart-items');

        function updateCartCount() {
            cartCount = cart.reduce((total, item) => total + item.quantity, 0);
            document.querySelector('.cart-btn span').textContent = cartCount;
        }

        function formatPrice(price) {
            const parsedPrice = parseFloat(price);
            if (isNaN(parsedPrice)) {
                console.error('Invalid price:', price);
                return '0.00€';
            }
            return Number.isInteger(parsedPrice) ? `${parsedPrice}€` : `${parsedPrice.toFixed(2)}€`;
        }


        function addToCartProduct(productId, event) {
            const productElement = event.target.closest('.product');
            if (!productElement) {
                console.error('Product element not found.');
                return;
            }

            const productName = productElement.querySelector('h4').textContent;
            const priceText = productElement.querySelector('h3').textContent.trim();
            console.log('Extracted price text:', priceText);

            const productPrice = parseFloat(priceText.replace(/[^0-9.]/g, '').replace(',', '.'));
            console.log('Parsed price:', productPrice);

            if (isNaN(productPrice)) {
                console.error('Invalid price format:', priceText);
                return;
            }

            const productImage = productElement.querySelector('img').src;

            const existingProduct = cart.find(item => item.id === productId);
            if (existingProduct) {
                existingProduct.quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: productName,
                    price: productPrice,
                    image: productImage,
                    quantity: 1,
                });
            }

            updateCartCount();
            updateCartDisplay();
            showCartPopup();
        }

        function updateCartDisplay() {
            const cartItems = document.querySelector('.cart-items');
            if (!cartItems) return;

            cartItems.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                cartItems.innerHTML = '<div class="empty-cart-message">Your cart is empty</div>';
                document.getElementById('cartTotal').textContent = '00.00€';
                return;
            }

            cart.forEach((item, index) => {
                let itemTotal;
                if (item.basePrice !== undefined && item.addons) {
                    const addonsTotalPrice = item.addons.reduce((sum, addon) => sum + addon.price, 0);
                    itemTotal = (item.basePrice + addonsTotalPrice) * item.quantity;
                } else if (item.price !== undefined) {
                    itemTotal = item.price * item.quantity;
                } else {
                    console.error('Invalid item structure:', item);
                    return;
                }

                total += itemTotal;

                const addonsHtml = item.addons && item.addons.length > 0 ?
                    `<div class="cart-item-addons">
                            ${item.addons.map(addon => 
                                `<span class="addon-tag"> ${addon.label} - (+${formatPrice(addon.price)})</span>`
                            ).join('')}
                    </div>` :
                    '';

                cartItems.innerHTML += `
                    <div class="cart-item">
                        <img src="${item.image}" alt="${item.name}">
                        <div class="cart-item-details">
                            <h4>${item.name}</h4>
                            <p class="cart-item-price">${formatPrice(itemTotal)}</p>
                            ${addonsHtml}
                        </div>
                        <div class="quantity-controls">
                            <button onclick="updateQuantity(${index}, -1)">-</button>
                            <input type="text" class="product-quantity" value="${item.quantity}" 
                                min="1" onchange="changeQuantity(${index}, this.value)">
                            <button onclick="updateQuantity(${index}, 1)">+</button>
                        </div>
                        <span class="remove-item" onclick="removeFromCart(${index})">&times;</span>
                    </div>
                `;
            });

            document.getElementById('cartTotal').textContent = formatPrice(total);
        }



        // function updateCartDisplay() {
        //     const cartItems = document.querySelector('.cart-items');
        //     if (!cartItems) return;

        //     cartItems.innerHTML = '';
        //     let total = 0;

        //     if (cart.length === 0) {
        //         cartItems.innerHTML = '<div class="empty-cart-message">Your cart is empty</div>';
        //         document.getElementById('cartTotal').textContent = '0.00€';
        //         return;
        //     }

        //     cart.forEach((item, index) => {
        //         const itemTotal = item.totalPrice * item.quantity;
        //         total += itemTotal;

        //         const addonsHtml = item.addons && item.addons.length > 0 ?
        //             `<div class="cart-item-addons">
        //                 ${item.addons.map(addon => 
        //                     `<span class="addon-tag">${addon.label} (+${addon.price}€)</span>`
        //                 ).join('')}
        //             </div>` :
        //             '';

        //             cartItems.innerHTML += `
        //                 <div class="cart-item">
        //                     <img src="${item.image}" alt="${item.name}">
        //                     <div class="cart-item-details">
        //                         <h4>${item.name}</h4>
        //                         <p class="cart-item-price">${(item.totalPrice * item.quantity).toFixed(2)}€</p>
        //                         ${addonsHtml}
        //                     </div>
        //                     <div class="quantity-controls">
        //                         <button onclick="updateQuantity(${index}, -1)">-</button>
        //                         <input type="text" class="product-quantity" value="${item.quantity}" 
        //                             min="1" onchange="changeQuantity(${index}, this.value)">
        //                         <button onclick="updateQuantity(${index}, 1)">+</button>
        //                     </div>
        //                     <span class="remove-item" onclick="removeFromCart(${index})">&times;</span>
        //                 </div>
        //             `;
        //         });

        //     document.getElementById('cartTotal').textContent = total.toFixed(2) + '€';
        // }

        function updateQuantity(index, change) {
            const product = cart[index];
            if (!product) return;

            product.quantity += change; // Adjust quantity
            if (product.quantity < 1) {
                removeFromCart(index); // Remove product if quantity < 1
                return;
            }

            updateCartCount(); // Refresh count
            updateCartDisplay(); // Refresh cart
        }

        function changeQuantity(index, newQuantity) {
            const product = cart[index];
            if (!product) return;

            const quantity = parseInt(newQuantity, 10);
            if (isNaN(quantity) || quantity < 1) {
                product.quantity = 1;
            } else {
                product.quantity = quantity;
            }

            updateCartCount();
            updateCartDisplay();
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartCount();
            updateCartDisplay();
        }

        function showCartPopup() {
            document.getElementById('cartPopup').style.display = 'block';
        }

        function hideCartPopup() {
            document.getElementById('cartPopup').style.display = 'none';
        }

        window.addEventListener('click', (e) => {
            if (e.target === document.getElementById('cartPopup')) {
                hideCartPopup();
            }
        });

        document.querySelector('.cart-btn').addEventListener('click', showCartPopup);
        document.querySelector('.close-cart').addEventListener('click', hideCartPopup);
    </script>




    <!-- PRODUCT-ADDONS -->
    <script>
        document.querySelectorAll('.custom-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const label = this.nextElementSibling;

                if (this.checked) {
                    label.classList.remove('unchecked');
                    label.classList.add('checked');
                } else {
                    label.classList.remove('checked');
                    label.classList.add('unchecked');
                }
            });
        });
    </script>



































    <!-- SWIPER-CATEGORIES -->
    <!-- <script>
        document.addEventListener("DOMContentLoaded", () => {
            const swiper = new Swiper('.swiper-categories', {
                loop: true,
                autoplay: {
                    delay: 0,
                    disableOnInteraction: false,
                },
                speed: 5000,
                slidesPerView: 'auto',
                spaceBetween: 30,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                breakpoints: {
                    640: {
                        // slidesPerView: 1,
                        spaceBetween: 30,
                    },
                    800: {
                        // slidesPerView: 2,
                        spaceBetween: 30,
                    },
                    1000: {
                        // slidesPerView: 3,
                        spaceBetween: 30,
                    },
                    1224: {
                        slidesPerView: 3,
                        spaceBetween: 30,
                    }
                }
            });
        });
    </script> -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const swiper = new Swiper('.swiper-categories', {
                slidesPerView: "auto",
                spaceBetween: 30,
                centeredSlides: true,
                loop: true,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                on: {
                    slideChangeTransitionEnd: function() {
                        adjustSlideSizes();
                    },
                },
            });

            // Adjust slide sizes on initialization
            adjustSlideSizes();

            function adjustSlideSizes() {
                const slides = document.querySelectorAll('.swiper-slide');
                slides.forEach((slide) => {
                    slide.classList.remove('swiper-slide-active-custom');
                });

                const activeSlide = document.querySelector('.swiper-slide.swiper-slide-active');
                if (activeSlide) {
                    activeSlide.classList.add('swiper-slide-active-custom');
                }
            }
        });
    </script>
    <!-- SWIPER-PRODUCTS -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const swiper = new Swiper('.swiper-products', {
                loop: true,
                // autoplay: {
                //     delay: 0,
                //     disableOnInteraction: false,
                // },
                // speed: 5000,
                slidesPerView: 'auto',
                spaceBetween: 30,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                breakpoints: {
                    640: {
                        // slidesPerView: 1,
                        spaceBetween: 30,
                    },
                    800: {
                        // slidesPerView: 2,
                        spaceBetween: 30,
                    },
                    1000: {
                        // slidesPerView: 3,
                        spaceBetween: 30,
                    },
                    1224: {
                        // slidesPerView: 4,
                        spaceBetween: 30,
                    }
                }
            });
        });
    </script>
    <!-- NEWSLETTER -->
    <script>
        document.getElementById('newsletter-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const responseDiv = document.getElementById('newsletter-response');

            fetch(newsletterAjax.ajax_url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        action: 'subscribe_newsletter',
                        email: email
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        responseDiv.innerHTML = `<p style="color: green;">${data.data.message}</p>`;
                    } else {
                        responseDiv.innerHTML = `<p style="color: red;">${data.data.message}</p>`;
                    }
                })
                .catch(error => {
                    responseDiv.innerHTML = `<p style="color: red;">An error occurred. Please try again later.</p>`;
                });
        });
    </script>
</div>

<?php get_footer(); ?>