<?php
/*  
Template Name: Custom Homepage  
*/
get_header();
?>

<div>

    <div class="section-hero-container">
        <section class="section-hero">
            <div class="section-top container mb-5">
                <h1>ALOHA<span>SUSHI</span></h1>
                <div class="section-top-content">
                    <div class="section-top-text">
                        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Magni dicta ut explicabo vel quisquam molestias libero ipsa? Illum necessitatibus cumque, animi, rerum similique deleniti deserunt itaque vero dicta, voluptate pariatur.</p>
                        <!-- <button><i class="fa-solid fa-truck-fast"></i> ORDER NOW</button> -->
                    </div>
                    <div class="section-top-img">
                        <img class="" src="<?php echo get_template_directory_uri(); ?>/imgs/plate-4.png" alt="Sushi Image">
                    </div>
                    <div class="section-top-imgs">
                        <img class="" src="<?php echo get_template_directory_uri(); ?>/imgs/plate-1.jpg" alt="Sushi Image">
                        <img class="" src="<?php echo get_template_directory_uri(); ?>/imgs/plate-2.jpg" alt="Sushi Image">
                        <img class="" src="<?php echo get_template_directory_uri(); ?>/imgs/plate-3.png" alt="Sushi Image">
                        <img class="" src="<?php echo get_template_directory_uri(); ?>/imgs/plate-4.png" alt="Sushi Image">
                    </div>


                </div>
            </div>

            <div id="scroll-container">
                <div id="scroll-text">
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>

                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>

                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                </div>
            </div>

            <div id="scroll-container-bottom">

                <div id="scroll-text-bottom">
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>

                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>

                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-burger"></i>
                        <h1>FAST SHIPPING</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-pizza-slice"></i>
                        <h1>30 MINUTES</h1>
                    </div>
                    <div>
                        <i class="fa-solid fa-french-fries"></i>
                        <h1>SO HOT</h1>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- CATEGORY -->
    <section class="section-categories container">
        <div class="title-top">
            <h1>OUR BEST <span>CATEGORIES</span></h1>
            <button>SEE ALL <i class="fas fa-arrow-right"></i></button>
        </div>

        <div class="swiper-container swiper-categories">
            <div class="swiper-wrapper">
                <?php
                $args = array(
                    'taxonomy'   => 'product_cat',
                    'orderby'    => 'name',
                    'hide_empty' => true,
                );
                $categories = get_terms($args);
                $menu_url = home_url('/menu');

                if (!empty($categories)) {
                    foreach ($categories as $category) {
                        // Get category details
                        $thumbnail_id = get_term_meta($category->term_id, 'thumbnail_id', true);
                        $image_url = wp_get_attachment_url($thumbnail_id);
                        $product_count = isset($category->count) ? $category->count : 0;

                        // Build the category URL with filter
                        $category_url = add_query_arg('category', $category->slug, $menu_url);

                        // Output each category as a slide
                        echo '<div class="swiper-slide">';
                        echo '<div class="category">';
                        if ($image_url) {
                            echo '<a href="' . esc_url($category_url) . '">';
                            echo '<img src="' . esc_url($image_url) . '" alt="' . esc_attr($category->name) . '">';
                            echo '</a>';
                        }
                        echo '<a class="category-content" href="' . esc_url($category_url) . '">';
                        echo '<h2>' . esc_html(strtoupper($category->name)) . '</h2>';
                        echo '<h4>' . esc_html($product_count) . ' products</h4>';
                        echo '</a>';
                        echo '</div>';
                        echo '</div>';
                    }
                }
                ?>
            </div>
            <div class="bottom-arc"></div>

            <!-- Add Pagination -->
            <!-- <div class="swiper-pagination"></div> -->

            <!-- Add Navigation (Optional) -->
            <!-- <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div> -->
        </div>
    </section>
    <!-- WHY -->
    <section class="section-why">
        <div class="wave-top"></div>
        <div class="container">
            <div class="image-container" data-aos="fade-up-right" data-aos-duration="1500" data-aos-easing="ease-in-out">
                <img src="<?php echo get_template_directory_uri(); ?>/imgs/img-1.png" alt="Sushi Image">
            </div>
            <div class="content" data-aos="fade-up-left" data-aos-duration="1500" data-aos-easing="ease-in-out">
                <h2 class="title">WHY CHOOSE <span>US</span></h2>
                <p>The mouth-watering aroma of sizzling burgers now fills the streets of Birmingham thanks to the passionate pursuit of three brothers</p>

                <div class="features">
                    <div class="feature">
                        <div class="feature-icon">üç£</div>
                        <h3>A NEW LOOK ON THE RIGHT DOOR!</h3>
                    </div>
                    <div class="feature">
                        <div class="feature-icon">ü•ó</div>
                        <h3>THE USE OF NATURAL BEST QUALITY PRODUCTS</h3>
                    </div>
                    <div class="feature">
                        <div class="feature-icon">üöö</div>
                        <h3>FASTEST ON YOUR DOOR STEP</h3>
                    </div>
                </div>

                <button class="order-btn">ORDER NOW ‚Üí</button>
            </div>
        </div>
        <div class="wave-bottom"></div>
    </section>
    <!-- PRODUCTS -->
    <section class="section-products container">
        <!-- Display Products -->
        <div class="title-top">
            <h1>OUR BEST <span> DISHES</span></h1>
            <button>SEE ALL <i class="fas fa-arrow-right"></i></button>
        </div>

        <div class="swiper-container swiper-products">
            <div class="swiper-wrapper">
                <?php
                $args = array(
                    'post_type' => 'product',
                    'posts_per_page' => 5,
                );
                $loop = new WP_Query($args);

                if ($loop->have_posts()) {
                    while ($loop->have_posts()) : $loop->the_post();
                ?>

                        <div class="swiper-slide">
                            <div class="product">
                                <a class="a" onclick="showProductDetails('<?php echo esc_attr($product->get_id()); ?>')">
                                    <div class="product-top">
                                        <?php if (has_post_thumbnail()) {
                                            the_post_thumbnail('medium', ['class' => 'img']);
                                        } ?>
                                        <div class="product-recepies">
                                            <p>Lorem.</p>
                                            <p>Lorem.</p>
                                            <p>Lorem.</p>
                                        </div>
                                    </div>
                                </a>
                                <div class="product-content">
                                    <h4><?php the_title(); ?></h4>
                                    <p>Lorem ipsum | dolor | sit amet | consectetur.</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h3><?php echo get_post_meta(get_the_ID(), '_price', true); ?>‚Ç¨</h3>

                                        <i onclick="addToCartProduct(<?php echo esc_attr($product->get_id()); ?>, event)" class="fa-solid fa-cart-shopping"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                <?php
                    endwhile;
                } else {
                    echo 'No products found.';
                }
                wp_reset_postdata();
                ?>
            </div>

            <!-- Add Pagination -->
            <!-- <div class="swiper-pagination"></div> -->

            <!-- Add Navigation (Optional) -->
            <!-- <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div> -->
        </div>





    </section>
    <!-- PROMO -->
    <div class="promo">

        <div class="wave-top"></div>
        <div class="promo-section">
            <div class="container">
                <p data-aos="fade-up-right" data-aos-duration="1500" data-aos-easing="ease-in-out">40% OFF ALL PREMIUM PIZZAS</p>
                <h1 data-aos="fade-up-left" data-aos-duration="1500" data-aos-easing="ease-in-out">HAPPY SUNDAY</h1>
                <a href="#" class="order-btn">ORDER NOW</a>
                <div class="promo-img-1">
                    <img src="<?php echo get_template_directory_uri(); ?>/imgs/img-5.png" alt="Sushi Image">
                </div>
                <div class="promo-img-2">
                    <img src="<?php echo get_template_directory_uri(); ?>/imgs/img-1.png" alt="Sushi Image">
                </div>
            </div>
        </div>
        <div class="wave-bottom"></div>
    </div>
    <!-- ORDER -->
    <section class="section-order" data-aos="fade-up" data-aos-duration="1500" data-aos-easing="ease-in-out">
        <a href="">
            <div class="order-img container">
                <img src="<?php echo get_template_directory_uri(); ?>/imgs/promo-bg-3.png" alt="Sushi Image">
            </div>
        </a>
    </section>
    <!-- DISHES -->
    <section class="section-products-dishes">

        <div class="wave-top"></div>
        <!-- Display Products -->
        <div class="title-top container">
            <h1>OUR BEST <span>DISHES</span></h1>
            <button>SEE ALL <i class="fas fa-arrow-right"></i></button>
        </div>


        <div class="swiper-container container swiper-products">
            <div class="swiper-wrapper">
                <?php
                $args = array(
                    'post_type' => 'product',
                    'posts_per_page' => 12,
                );
                $loop = new WP_Query($args);

                if ($loop->have_posts()) {
                    while ($loop->have_posts()) : $loop->the_post();
                ?>

                        <div class="swiper-slide">
                            <div class="product">
                                <a class="a" onclick="showProductDetails('<?php echo esc_attr($product->get_id()); ?>')">
                                    <div class="product-top">
                                        <?php if (has_post_thumbnail()) {
                                            the_post_thumbnail('medium', ['class' => 'img']);
                                        } ?>
                                        <div class="product-recepies">
                                            <p>Lorem.</p>
                                            <p>Lorem.</p>
                                            <p>Lorem.</p>
                                        </div>
                                    </div>
                                </a>
                                <div class="product-content">
                                    <h4><?php the_title(); ?></h4>
                                    <p>Lorem ipsum | dolor | sit amet | consectetur.</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h3><?php echo get_post_meta(get_the_ID(), '_price', true); ?>‚Ç¨</h3>
                                        <i onclick="addToCartProduct('<?php echo esc_attr($product->get_id()); ?>', event)" class="fa-solid fa-cart-shopping"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                <?php
                    endwhile;
                } else {
                    echo 'No products found.';
                }
                wp_reset_postdata();
                ?>
            </div>

            <!-- Add Pagination -->
            <!-- <div class="swiper-pagination"></div> -->

            <!-- Add Navigation (Optional) -->
            <!-- <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div> -->
        </div>

        <div class="wave-bottom"></div>
    </section>
    <!-- PROMOTION -->
    <section class="section-promo-container">
        <div class="section-promo container">
            <div class="promo-img" data-aos="fade-right" data-aos-duration="1500" data-aos-easing="ease-in-out">
                <img src="<?php echo get_template_directory_uri(); ?>/imgs/promo-1.jpg" alt="Sushi Image">
            </div>
            <div class="promo-content">
                <div class="promo-content-img" data-aos="flip-down" data-aos-duration="1500" data-aos-easing="ease-in-out">
                    <img src="<?php echo get_template_directory_uri(); ?>/imgs/promo-bg-1.jpg" alt="Sushi Image">
                </div>
                <div class="promo-content-img" data-aos="flip-down" data-aos-duration="1500" data-aos-easing="ease-in-out">
                    <img src="<?php echo get_template_directory_uri(); ?>/imgs/promo-bg-3.png" alt="Sushi Image">
                </div>
            </div>
        </div>
    </section>
    <!-- NEWSLETTER -->
    <section class="section-newsletter-container">
        <div class="section-newsletter container">
            <div class="d-flex flex-column justify-content-center align-items-center">
                <h1 data-aos="fade-up-left" data-aos-duration="1500" data-aos-easing="ease-in-out">JOIN FOR HOT OFFERS!</h1>
                <p data-aos="fade-up-right" data-aos-duration="1500" data-aos-easing="ease-in-out">Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptatem eveniet nesciunt fugiat itaque unde non debitis sit porro, obcaecati ex. Eius voluptate perspiciatis facilis, inventore cupiditate suscipit eum voluptates voluptas!
                </p>
            </div>
            <div>
                <form id="newsletter-form">
                    <input type="email" name="email" id="email" placeholder="Enter your adress email" required data-aos="fade-up-left" data-aos-duration="1500" data-aos-easing="ease-in-out">
                    <button data-aos="fade-up-right" data-aos-duration="1500" data-aos-easing="ease-in-out"><i class="fa-solid fa-paper-plane me-1"></i> Subscribe</button>
                </form>
            </div>
            <img class="newsletter-img-left" src="<?php echo get_template_directory_uri(); ?>/imgs/img-2.png" alt="Sushi Image">
            <img class="newsletter-img-right" src="<?php echo get_template_directory_uri(); ?>/imgs/img-1.png" alt="Sushi Image">

        </div>
    </section>







    <!-- PANIER -->
    <section class="cart-btn-container">
        <div class="cart-btn">
            <span value="0">0</span>
            <h4><i class="fa-solid fa-cart-shopping"></i></h4>
        </div>
    </section>

    <!-- SHOPING CART -->
    <div class="cart-popup" id="cartPopup">
        <div class="cart-popup-content">
            <div class="cart-header">
                <h3>Shopping Cart</h3>
                <span class="close-cart">&times;</span>
            </div>
            <div class="cart-items">
                <div class="cart-empty-message">
                    <div id="empty-cart-message" style="display: none;">
                        <h1 style="font-size: 3rem;"><i class="fa-regular fa-calendar-xmark"></i></h1>
                        <p>YOUR CART IS EMPTY ORDER NOW!!</p>
                    </div>
                </div>
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    <span>Total:</span>
                    <span id="cartTotal">0.00‚Ç¨</span>
                </div>
                <button class="checkout-btn">Checkout</button>
            </div>
        </div>
    </div>






















    <!-- Product-details -->
    <div id="productDetailsPopup" class="product-details-popup" style="display: none;">
        <div class="product-details-content">
            <button class="close-popup" onclick="closeProductDetails()">&times;</button>
            <div id="productDetailsContent">
            </div>
        </div>
    </div>

    <div>
        <!-- $api_url = "http://localhost/aloha_sushi/wp-json/wc/v3/products/$product_id"; -->
    </div>

    <script>
        <?php
        $rest_url = esc_url_raw(rest_url('/wc/v3/products/'));
        $consumer_key = 'ck_293896f56cc0ecddc28b4c79984c73c52a6a43e2';
        $consumer_secret = 'cs_349bd60084e10ae4acd409f011055f68bf073fec';
        ?>

        let cart = [];
        let cartCount = 0;

        function showProductDetails(productId) {
            const popup = document.getElementById('productDetailsPopup');
            const content = document.getElementById('productDetailsContent');

            content.innerHTML = '<div class="product-details-loading"><p class="loader"></p></div>';
            popup.style.display = 'flex';

            fetch(`<?php echo $rest_url; ?>${productId}`, {
                    headers: {
                        'Authorization': 'Basic ' + btoa('<?php echo $consumer_key; ?>:<?php echo $consumer_secret; ?>')
                    }
                })
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(product => {
                    const imageSrc = product.images && product.images.length > 0 ? product.images[0].src : '';
                    const imageAlt = product.name || 'Product Image';

                    content.innerHTML = `
                <div class="product-popup-content">  
                    <div>
                        <img src="${imageSrc}" alt="${imageAlt}"> 
                    </div>
                    <div class="p-details-content">
                        <div class="product-details-content-top">
                            <h2>${product.name}</h2>
                            <div class="quantity-controls">
                                <button onclick="changeProductQuantity(${productId}, -1)">-</button>
                                <input type="text" id="productQuantity" class="product-quantity" value="0" min="0">
                                <button onclick="changeProductQuantity(${productId}, 1)">+</button>
                            </div>
                        </div> 
                        <div class="accordion" id="accordionExample">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                        DESCRIPTION
                                    </button>
                                </h2>
                                <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <strong>${product.description} description...</strong>
                                </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    Alergens
                                </button>
                                </h2>
                                <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <strong>ALERGANS</strong>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="productAddonsContainer" class="product-addons-container">
                        <p>Loading addons...</p>
                    </div>

                    <div class="product-details-buy">
                        <div class="product-price">  
                            <strong>${product.sale_price}‚Ç¨</strong>   
                        </div> 
                        <i class="fa-solid fa-cart-shopping add-to-cart-btn" onclick="addToCart(${product.id})"></i>
                    </div>
                </div>  
            `;

                    // Fetch and render addons
                    fetchProductAddons(productId);
                })
                .catch(error => {
                    content.innerHTML = '<p class="mt-5">Error loading product details. Please try again.</p>';
                    console.error('Error:', error);
                });
        }


        function fetchProductAddons(productId) {
            const addonsContainer = document.getElementById('productAddonsContainer');

            fetch(`/aloha_sushi/wp-json/custom/v1/product-addons/${productId}`)
                .then(response => {
                    if (!response.ok) throw new Error('Failed to fetch addons');
                    return response.json();
                })
                .then(addons => {
                    if (addons.length === 0) {
                        addonsContainer.innerHTML = '<p>No addons available for this product.</p>';
                        return;
                    }

                    addonsContainer.innerHTML = addons.map(addon => `
                <div class="addon-group">
                    <h4>${addon.group_title}</h4>
                    ${addon.fields.map(field => `
                        <div class="addon-field"> 
                            <div class="addon-content">
                                ${field.type === 'radio' ? `
                                    ${field.options.map(option => `
                                        <div class="addon-option">
                                            <label>
                                                ${option.image ? `<img src="${option.image}" alt="${option.label}" class="addon-image">` : ''}
                                                ${option.label} (+${option.price}‚Ç¨)
                                            </label>
                                            <input type="radio" name="addon_${field.id}" value="${option.id}">
                                        </div>
                                    `).join('')}
                                ` : ''}
                                ${field.type === 'checkbox' ? `
                                    ${field.options.map(option => `
                                        <div class="addon-option">
                                            <label class="checkbox-label">
                                                ${option.image ? `<img src="${option.image}" alt="${option.label}" class="addon-image">` : ''}
                                                
                                                ${option.label} / +${option.price}‚Ç¨
                                            </label>
                                            <input type="checkbox" class="custom-checkbox" name="addon_${field.id}[]" value="${option.id}">
                                        </div>
                                    `).join('')}
                                ` : ''}
                                ${field.type === 'select' ? `
                                    <select name="addon_${field.id}">
                                        ${field.options.map(option => `
                                            <option value="${option.id}">
                                                ${option.label} (+${option.price}‚Ç¨)
                                            </option>
                                        `).join('')}
                                    </select>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
                })
                .catch(error => {
                    addonsContainer.innerHTML = '<p>Error loading addons. Please try again.</p>';
                    console.error('Error:', error);
                });
        }


        function closeProductDetails() {
            document.getElementById('productDetailsPopup').style.display = 'none';
        }

        function changeProductQuantity(productId, delta) {
            const quantityInput = document.getElementById('productQuantity');
            let newQuantity = parseInt(quantityInput.value) + delta;
            if (newQuantity < 1) newQuantity = 1; // Ensure quantity stays positive
            quantityInput.value = newQuantity;
        }

        function addToCart(productId) {
            const quantityInput = document.getElementById('productQuantity');
            const quantity = parseInt(quantityInput.value) || 1; // Default to 1 if input is invalid

            // Fetch product details again to get the latest data
            fetch(`<?php echo $rest_url; ?>${productId}`, {
                    headers: {
                        'Authorization': 'Basic ' + btoa('<?php echo $consumer_key; ?>:<?php echo $consumer_secret; ?>')
                    }
                })
                .then(response => response.json())
                .then(product => {
                    const productName = product.name;
                    const productPrice = parseFloat(product.sale_price);
                    const productImage = product.images && product.images.length > 0 ? product.images[0].src : '';

                    // Check if the product already exists in the cart
                    const existingProduct = cart.find(item => item.id === productId);
                    if (existingProduct) {
                        existingProduct.quantity += quantity;
                    } else {
                        cart.push({
                            id: productId,
                            name: productName,
                            price: productPrice,
                            image: productImage,
                            quantity: quantity,
                        });
                    }

                    updateCartCount();
                    updateCartDisplay();
                    showCartPopup();
                })
                .catch(error => {
                    console.error('Error adding product to cart:', error);
                });
        }

        // SHOPPING CART
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const cartItems = document.getElementById('cart-items');

        // V√©rifiez si le panier est vide
        if (cart.length === 0) {
            emptyCartMessage.style.display = 'flex';
            emptyCartMessage.style.justifyContent = 'center';
            emptyCartMessage.style.alignItems = 'center';
        } else {
            emptyCartMessage.style.display = 'none';
            cart.forEach(item => {
                const productDiv = document.createElement('div');
                productDiv.textContent = `Produit : ${item.name}`;
                cartItems.appendChild(productDiv);
            });
        }

        function addToCartProduct(productId, event) {
            const productElement = event.target.closest('.product'); // Find the product element
            if (!productElement) {
                console.error('Product element not found.');
                return;
            }

            const productName = productElement.querySelector('h4').textContent;
            const productPrice = parseFloat(
                productElement.querySelector('h3').textContent.replace(/[^0-9.-]+/g, '')
            );
            const productImage = productElement.querySelector('img').src;

            // Check if the product already exists in the cart
            const existingProduct = cart.find(item => item.id === productId);
            if (existingProduct) {
                existingProduct.quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: productName,
                    price: productPrice,
                    image: productImage,
                    quantity: 1,
                });
            }

            updateCartCount();
            updateCartDisplay();
            showCartPopup();
        }

        function updateCartCount() {
            cartCount = cart.reduce((total, item) => total + item.quantity, 0);
            document.querySelector('.cart-btn span').textContent = cartCount;
        }

        function updateCartDisplay() {
            const cartItems = document.querySelector('.cart-items');
            cartItems.innerHTML = ``;
            let total = 0;

            cart.forEach((item, index) => {
                total += item.price * item.quantity;
                cartItems.innerHTML += `
                <div class="cart-item">
                    <img src="${item.image}" alt="${item.name}">
                    <div class="cart-item-details">
                        <h4>${item.name}</h4>
                        <p class="cart-item-price">${(item.price * item.quantity).toFixed(2)}‚Ç¨</p>
                    </div>
                    <div class="quantity-controls">
                        <button onclick="updateQuantity(${index}, -1)">-</button>
                        <input type="text" class="product-quantity" value="${item.quantity}" min="0" onchange="changeQuantity(${index}, this.value)">
                        <button onclick="updateQuantity(${index}, 1)">+</button>
                    </div>
                    <span class="remove-item" onclick="removeFromCart(${index})">&times;</span>
                </div>
            `;
            });

            // Update total price in the UI
            document.getElementById('cartTotal').textContent = total.toFixed(2) + '‚Ç¨';
        }

        function updateQuantity(index, change) {
            const product = cart[index];
            if (!product) return;

            product.quantity += change; // Adjust quantity
            if (product.quantity < 1) {
                removeFromCart(index); // Remove product if quantity < 1
                return;
            }

            updateCartCount(); // Refresh count
            updateCartDisplay(); // Refresh cart
        }

        function changeQuantity(index, newQuantity) {
            const product = cart[index];
            if (!product) return;

            const quantity = parseInt(newQuantity, 10); // Parse input
            if (isNaN(quantity) || quantity < 1) {
                product.quantity = 1; // Default to 1 if invalid
            } else {
                product.quantity = quantity; // Update quantity
            }

            updateCartCount(); // Refresh count
            updateCartDisplay(); // Refresh cart
        }

        function removeFromCart(index) {
            cart.splice(index, 1); // Remove item from cart array
            updateCartCount(); // Refresh count
            updateCartDisplay(); // Refresh cart
        }

        function showCartPopup() {
            document.getElementById('cartPopup').style.display = 'block';
        }

        function hideCartPopup() {
            document.getElementById('cartPopup').style.display = 'none';
        }

        // Close the cart when clicking outside the popup
        window.addEventListener('click', (e) => {
            if (e.target === document.getElementById('cartPopup')) {
                hideCartPopup();
            }
        });

        // Event listeners for cart interactions
        document.querySelector('.cart-btn').addEventListener('click', showCartPopup);
        document.querySelector('.close-cart').addEventListener('click', hideCartPopup);
    </script>




    <!-- PRODUCT-ADDONS -->
    <script>
        document.querySelectorAll('.custom-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const label = this.nextElementSibling;

                if (this.checked) {
                    label.classList.remove('unchecked');
                    label.classList.add('checked');
                } else {
                    label.classList.remove('checked');
                    label.classList.add('unchecked');
                }
            });
        });
    </script>



































    <!-- SWIPER-CATEGORIES -->
    <!-- <script>
        document.addEventListener("DOMContentLoaded", () => {
            const swiper = new Swiper('.swiper-categories', {
                loop: true,
                autoplay: {
                    delay: 0,
                    disableOnInteraction: false,
                },
                speed: 5000,
                slidesPerView: 'auto',
                spaceBetween: 30,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                breakpoints: {
                    640: {
                        // slidesPerView: 1,
                        spaceBetween: 30,
                    },
                    800: {
                        // slidesPerView: 2,
                        spaceBetween: 30,
                    },
                    1000: {
                        // slidesPerView: 3,
                        spaceBetween: 30,
                    },
                    1224: {
                        slidesPerView: 3,
                        spaceBetween: 30,
                    }
                }
            });
        });
    </script> -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const swiper = new Swiper('.swiper-categories', {
                slidesPerView: "auto",
                spaceBetween: 30,
                centeredSlides: true,
                loop: true,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                on: {
                    slideChangeTransitionEnd: function() {
                        adjustSlideSizes();
                    },
                },
            });

            // Adjust slide sizes on initialization
            adjustSlideSizes();

            function adjustSlideSizes() {
                const slides = document.querySelectorAll('.swiper-slide');
                slides.forEach((slide) => {
                    slide.classList.remove('swiper-slide-active-custom');
                });

                const activeSlide = document.querySelector('.swiper-slide.swiper-slide-active');
                if (activeSlide) {
                    activeSlide.classList.add('swiper-slide-active-custom');
                }
            }
        });
    </script>
    <!-- SWIPER-PRODUCTS -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const swiper = new Swiper('.swiper-products', {
                loop: true,
                // autoplay: {
                //     delay: 0,
                //     disableOnInteraction: false,
                // },
                // speed: 5000,
                slidesPerView: 'auto',
                spaceBetween: 30,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                breakpoints: {
                    640: {
                        // slidesPerView: 1,
                        spaceBetween: 30,
                    },
                    800: {
                        // slidesPerView: 2,
                        spaceBetween: 30,
                    },
                    1000: {
                        // slidesPerView: 3,
                        spaceBetween: 30,
                    },
                    1224: {
                        // slidesPerView: 4,
                        spaceBetween: 30,
                    }
                }
            });
        });
    </script>
    <!-- NEWSLETTER -->
    <script>
        document.getElementById('newsletter-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const responseDiv = document.getElementById('newsletter-response');

            fetch(newsletterAjax.ajax_url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        action: 'subscribe_newsletter',
                        email: email
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        responseDiv.innerHTML = `<p style="color: green;">${data.data.message}</p>`;
                    } else {
                        responseDiv.innerHTML = `<p style="color: red;">${data.data.message}</p>`;
                    }
                })
                .catch(error => {
                    responseDiv.innerHTML = `<p style="color: red;">An error occurred. Please try again later.</p>`;
                });
        });
    </script>
</div>

<?php get_footer(); ?>